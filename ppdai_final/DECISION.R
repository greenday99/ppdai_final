DECISION<-function(X){
library(lpSolveAPI)
library(ucminf)
library(Benchmarking)
X[X$CreditCode=='AAA','风险系数']<-1
X[X$CreditCode=='AA','风险系数']<-2
X[X$CreditCode=='A','风险系数']<-3
X[X$CreditCode=='B','风险系数']<-4
X[X$CreditCode=='C','风险系数']<-5
X[X$CreditCode=='D','风险系数']<-6
X[X$CreditCode=='E','风险系数']<-7
X[X$CreditCode=='F','风险系数']<-8
x<-cbind(X$inputAmount,X$Months,X$风险系数)
y=array(0,c(nrow(X),19))
y[,1]<-X$Months* X$inputAmount*(X$Rate/1200)*(1 +X$Rate/1200)^(X$Months)/((1+ (X$Rate/1200))^(X$Months) -1)
for(i in 1:18){
    y[,i+1]=(X$Months-i)* X$inputAmount*(X$Rate/1200)*(1 +X$Rate/1200)^(X$Months)/((1+ (X$Rate/1200))^(X$Months) -1)
}

for(j in 1:nrow(X))
{
    for(i in 1:19)
{
    if(y[j,i]<0){y[j,i]=0}
}
}

pAAA<-c(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)#AAA标
pAA<-c(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)#AA标
pA<-c(0.9856885,0.0007177514,0.001205822,0.001866154,0.002296805,0.002325515,0.002210674,0.0009187218,0.0007464615,0.0004306509,0.0003732307,0.0004593609,0.0002583905,5.742011e-05,2.871006e-05,1.000000e-04,5.742011e-05,8.613017e-05,1.722603e-04)
pB<-c(0.9794301,0.0008578245,0.001679906,0.002359017,0.002787930,0.002895158,0.002975579,0.0011973801,0.0011080233,0.0009025029,0.0006969824,0.0007237894,0.0006254970,3.395555e-04,3.574269e-04,3.395555e-04,3.038129e-04,2.412631e-04,1.787134e-04)
pC<-c(0.9805662,0.0008270238,0.001631424,0.002340301,0.002667089,0.002825455,0.002868189,0.0015132776,0.0013549114,0.0011814626,0.0008848401,0.0007742351,0.0005178325,1.005500e-05,7.541251e-06,7.541251e-06,1.005500e-05,7.541251e-06,5.027500e-06)
pD<-c(0.9699753,0.0010052231,0.001713956,0.002442997,0.002940531,0.003379174,0.003685818,0.0036127109,0.0033385591,0.0026156108,0.0021241684,0.0018276784,0.0013220207,2.030754e-06,2.030754e-06,2.030754e-06,4.061507e-06,4.061507e-06,2.030754e-06)
pE<-c(0.9525427,0.0019225402,0.002925155,0.003876089,0.004444582,0.004899377,0.005209464,0.0048890405,0.0048890405,0.0047443332,0.0040724777,0.0033592773,0.0012196761,3.410958e-04,3.617683e-04,9.302614e-05,1.033624e-05,1.000000e-04,1.000000e-04)
pF<-c(0.9067252,0.0040764689,0.005903852,0.007590666,0.008012370,0.009136913,0.010542592,0.0082935058,0.0070283947,0.0075906663,0.0080123700,0.0081529379,0.0066066910,1.827383e-03,1.000000e-04,1.000000e-04,1.000000e-04,1.000000e-04,1.000000e-04)
p<-rbind(pAAA,pAA,pA,pB,pC,pD,pE,pF)
R<-p[X$风险系数,]
EQ<-apply(y*R,1,sum)

e<- dea(x,y[,1],RTS="crs",ORIENTATION="in",SLACK=TRUE)
e_vrs<- dea(x,y[,1],RTS="vrs",ORIENTATION="in",SLACK=TRUE)
e1_vrs<- dea(x[,1],y[,1],RTS="vrs",ORIENTATION="in",SLACK=TRUE)
a<-data.frame(ListingId=X$ListingId,Title=X$Title,inputAmount=X$inputAmount,Months=X$Months,CreditCode=X$CreditCode,Rate=X$Rate,relativeEff=e$eff,expReturn=round(y[,1],2),avgReturn=round(EQ,2),adjuestedFund=e1_vrs$sx[1])
b<-a[order(a$avgReturn,decreasing = TRUE),]
return(b)}

